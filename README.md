# Кастомный пул потоков (CustomThreadPoolExecutor)

## Описание

Данный проект реализует собственный пул потоков с гибкой настройкой, балансировкой задач, логированием и политикой отказа. Пул поддерживает параметры corePoolSize, maxPoolSize, keepAliveTime, queueSize, minSpareThreads и позволяет управлять распределением задач между потоками.

## Основные компоненты
- **CustomExecutor** — интерфейс управления пулом.
- **CustomThreadPoolExecutor** — реализация пула потоков.
- **Worker** — рабочий поток, обрабатывающий задачи из своей очереди.
- **CustomThreadFactory** — фабрика потоков с уникальными именами и логированием.
- **CustomRejectedExecutionHandler** — обработчик отказа (логирует отклонённые задачи).

## Балансировка задач
Используется алгоритм Round Robin: задачи поочередно распределяются по очередям воркеров. Такой подход прост и эффективен для равномерных нагрузок. При необходимости можно реализовать Least Loaded (по наименьшей загруженности).

## Политика отказа
При переполнении очереди и невозможности создать новый поток задача отклоняется с логированием. Такой подход безопасен для высоконагруженных систем, но требует обработки отказов на уровне клиента. Альтернативы: выполнение задачи в текущем потоке (может привести к блокировке) или блокировка до освобождения места (риск дедлоков).

## Логирование
Пул логирует все ключевые события: создание/завершение потоков, поступление/отклонение задач, выполнение задач, idle timeout.

## Анализ производительности
- **Сравнение с стандартными пулами**: стандартные ThreadPoolExecutor оптимизированы для большинства задач, но кастомный пул позволяет гибко управлять балансировкой, отказами и резервированием потоков (minSpareThreads), что важно для специфических сценариев (например, web-серверы).
- **Параметры**: увеличение corePoolSize и queueSize повышает throughput, но увеличивает потребление памяти. minSpareThreads — компромисс между latency и ресурсами. maxPoolSize ограничивает рост числа потоков при пиковых нагрузках.
- **Рекомендации**: для максимальной производительности важно подобрать значения corePoolSize и queueSize под характер нагрузки. minSpareThreads полезен для обеспечения быстрой реакции на всплески запросов.

## Принцип работы
- При запуске создаётся corePoolSize воркеров, каждый с собственной очередью.
- Задачи распределяются по очередям по принципу Round Robin.
- Если очередь переполнена и число потоков меньше maxPoolSize, создаётся новый воркер.
- Если все очереди переполнены и достигнут maxPoolSize, задача отклоняется.
- Воркеры завершаются по idle timeout, если их больше corePoolSize и свободных потоков больше minSpareThreads.

## Запуск

### С помощью Maven

1.  **Сборка проекта**: Перейдите в корневую директорию проекта (где находится `pom.xml`) и выполните:
    ```bash
    mvn clean install
    ```

2.  **Запуск демонстрационной программы**: После успешной сборки запустите `Main`:
    ```bash
    mvn exec:java -Dexec.mainClass="Main"
    ```

3.  **Запуск тестов**: Для запуска всех тестов выполните:
    ```bash
    mvn test
    ```

## Пример вывода
```
[ThreadFactory] Creating new thread: MyPool-worker-1
[ThreadFactory] Creating new thread: MyPool-worker-2
[Pool] Task accepted into queue #0: ...
[Worker] MyPool-worker-1 executes ...
[Rejected] Task ... was rejected due to overload!
[Worker] MyPool-worker-2 idle timeout, stopping.
[Worker] MyPool-worker-1 terminated.
``` 